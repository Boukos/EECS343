<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" dir="ltr" >
<head>
      <base href="http://www.aqualab.cs.northwestern.edu/class/333-eecs343-xv6" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="FabiÃ¡n E. Bustamante" />
  <meta name="generator" content="Joomla! - Open Source Content Management" />
  <title>EECS343-xv6</title>
  <link href="/templates/aqualab-classes/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
  <link rel="stylesheet" href="/media/com_attachments/css/attachments_hide.css" type="text/css" />
  <link rel="stylesheet" href="/media/com_attachments/css/attachments_list.css" type="text/css" />
  <style type="text/css">

@import url('/css/classes/classes.css');
@import url('/css/classes/jquery-ui.css');
ol.second{ list-style-type:lower-latin; }
ul{padding-top: 1.0em;}

  </style>
  <script src="/media/system/js/mootools-core.js" type="text/javascript"></script>
  <script src="/media/system/js/core.js" type="text/javascript"></script>
  <script src="/media/system/js/caption.js" type="text/javascript"></script>
  <script src="/media/system/js/mootools-more.js" type="text/javascript"></script>
  <script src="/media/com_attachments/js/attachments_refresh.js" type="text/javascript"></script>
  <script type="text/javascript">
window.addEvent('load', function() {
				new JCaption('img.caption');
			});
  </script>

    <link rel="shortcut icon" href="/templates/aqualab-classes/favicon.ico" />
    <link rel="stylesheet" href="/templates/aqualab-classes/css/classes.css" type="text/css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>


<div id="system-message-container">
</div>
<div class="item-page">









 

<style>
.code { font-family: monospace; display: inline; font-size: 1.3em;}
</style>
<script type="text/javascript" src="/js/jquery-ui.js"></script>
<script type="text/javascript">
jQuery(function() {jQuery( "#tabs" ).tabs();});
</script>
<h2>EECS 343 - xv6</h2>
  
<div id="main" style="width: 100%;">

<h3>A bit about xv6</h3>
  
<p>
  In this course you will have the chance to learn about and work with <a href="http://pdos.csail.mit.edu/6.828/xv6" target="_blank">xv6</a>, a simple Unix-like teaching operating system from MIT. 
  
  <blockquote>"xv6 is a re-implementation of Dennis Ritchie's and Ken Thompson's Unix Version 6 (v6).  xv6 loosely follows the structure and style of v6,
but is implemented for a modern x86-based multiprocessor using ANSI C.<br>  
  
   xv6 is inspired by <a href="http://www.lemis.com/grog/Documentation/Lions/" target="_blank">John Lions's Commentary on UNIX 6th Edition</a> (Peer
to Peer Communications; ISBN: 1-57398-013-7; 1st edition (June 14,
2000))."<br><br><i>From the xv6 README file.</i></blockquote>
  
  <p>As with Lions' Commentary, there is a <a href="http://pdos.csail.mit.edu/6.828/2012/xv6/book-rev7.pdf" target="_blank">xv6 book</a>. Keep in mind that the version of xv6 we use is slightly older than that of the book and so you may note some differences.</p>
  
 <h3>Getting Started</h3>
  
  <p><b>(Project 1, Part 0)</b></p>
  <p>To work on xv6, you will use two set of tools:</p>
  <ol>
    <li><a href="http://wiki.qemu.org/Main_Page">QEMU</a>, an x86 emulator for running your kernel</li>
    <li>A compiler toolchain (assembler, linker, C compiler, and debugger) for compiling and testing your kernel. </li>
  </ol>
  
  <p>Some useful information about these tools can be found <a href="https://pdos.csail.mit.edu/6.828/2016/tools.html" target="_blank">here</a>.  Fortunately, these tools are already installed for you on the T-Lab and Wilkinson Lab machines.  Your TA has completed the xv6 projects on the lab machines and confirmed that everything is working, but please let us know ASAP if any problems arise with these tools.</p>
  
  <p>We will now walk you through how to get started with xv6, which will involve the following steps:</p>
  <ol>
    <li><a href="#download-xv6">Download the xv6 source code.</a></li>
    <li><a href="#compile-xv6">Compile the xv6 kernel.</a></li>
    <li><a href="#run-xv6">Run xv6 on QEMU.</a></li>
    <li><a href="#tour">Take a tour of xv6.</a></li>
    <li><a href="#exit-xv6-and-qemu">Exit xv6 and QEMU.</a></li>
    <li><a href="#gbd-remote-debugging">Run xv6 again, this time with GDB remote debugging enabled.</a></li>
    <li><a href="#exit-xv6-qemu-gdb">Exit xv6, QEMU and GDB.</a></li>
  </ol>
  
  <p>These instructions assume you are working from a lab machine, or at least SSH-ed into one.  It might be possible to complete these instructions from another environment, but it will be tricky.</p>
  
  <p>Without further ado, let's get going.</p>
  
  <h4 id="download-xv6">Download the source code:</h4>
  
  <p class="code">$ wget http://www.aqualab.cs.northwestern.edu/component/attachments/download/696 -O xv6.tar.gz</p>
  <p>The -O option above allows you to specify how to name the downloaded file.  You should now have a file named xv6.tar.gz.  This distribution of xv6 is a copy from our friends at UW-Madison, which they have restructured to make it easier to navigate the code.</p>
  <p>Ensure that your download worked properly by checking the SHA hash of the file:</p>
  <p class="code">$ sha256sum xv6.tar.gz</p>
  <p> Confirm that the output is identical to this:<br/> 
  <span class="code">fee5c515f1b8092306113b96d92998f84740732b98ddae63d41b1f89f2c60371  xv6.tar.gz</span></p>
  <p>Extract the files:</p>
  <p class="code">$ tar -xzvf xv6.tar.gz</p>
  
  <p>In the xv6 directory you will find:</p> 
    <blockquote class="code">
      FILES     .gitignore   include   kernel    Makefile    Makefile~
      README    tools        user      version
    </blockquote>
  
  <p>Look at <span class="code">FILES</span> using vim for a description of each directory.</p>
  
  <h4 id="compile-xv6">Compile the xv6 kernel:</h4>
  
  <p>In the xv6 directory, type <span class="code">make</span>.  When the compilation is complete, you should now find two additional files in the xv6 directory:</p>
  <blockquote class="code">
      fs.img    xv6.img
  </blockquote>
  
  <h4 id="run-xv6">Run xv6 on QEMU:</h4>
  
  <p>The command to run xv6 on QEMU is:</p>
  <p class="code">$ make qemu-nox</p>
  <p>The first time you will probably see this error:</p>
  <p class="code">
    ***<br/>
    *** Error: Couldn't find a working QEMU executable.<br/>
    *** Is the directory containing the qemu binary in your <br/>
    *** PATH or have you tried setting the QEMU variable in <br/>
    *** Makefile?<br/>
    ***<br/>
  </p>

  <p>As the error says, the QEMU executable wasn't found.  This can be easily solved by either modifying your PATH or modifying the Makefile.  We will show you how to modify the Makefile.  First, open the Makefile in a text editor:</p>
  <p class="code">$ vim Makefile</p>
  <p>Find the lines that look like this:</p>
  <p class="code">
    # If the makefile can't find QEMU, specify its path here<br/>
    #QEMU :=
  </p>
  <p>Uncomment the second line and modify it to look like this:</p>
  <p class="code">
    QEMU := /home/software/qemu/bin/qemu-system-i386
  </p>
  <p>Save and quit out of the Makefile.  Now you should be able to run xv6.  Try the command again:</p>
  <p class="code">$ make qemu-nox</p>
  <p>You may see a couple warnings, then you should see the following output lines as xv6 boots up:</p>
  <p class="code">
    xv6...<br/>
    lapicinit: 1 0xfee00000<br/>
    cpu1: starting<br/>
    cpu0: starting<br/>
    init: starting sh<br/>
    $ 
  </p>
  
  <h4 id="tour">Take a tour of xv6:</h4>
  
  <p>You are now in an xv6 shell.  Type <span class="code">ls</span> to see the list of programs that you can run.  You should see a few familiar commands such as '<span class="code">cat</span>' and '<span class="code">mkdir</span>'.  It is always good to start by reading the README:</p>
<p class="code">$ cat README</p>
<p>Interesting stuff, eh?  Now try running the rest of the provided programs to get a feel for what they do.  If a program doesn't exit on its own, you can kill it by typing:</p>
  <p><span class="code">control+d</span></p>
  
  <h4 id="exit-xv6-and-qemu">Exit xv6 and QEMU:</h4>
  
  <p>When you are done snooping around, you can exit xv6 by typing:</p>
  <p><span class="code">control+a</span></br>
    then release both keys and tap</br>
    <span class="code">x</span></p> 
  
  <h4 id="gbd-remote-debugging">Run xv6 again, this time with GDB remote debugging enabled:</h4>
  
  <p>The GNU Debugger (GDB) will be one of your best friends this quarter.  Any operating systems programming project at any college in the universe is basically composed of three parts:</p> 
  <ol>
    <li>Stare confusedly at the provided code trying to figure out what is going on and come up with a plan of attack.</li>
    <li>Write code.</li>
    <li>Spend hours in GDB trying to find all the reasons your code isn't working properly.</li>
  </ol>
  <p>Fortunately, xv6 allows you to "look inside" while it is running using GDB.  This requires two terminals: one to run xv6 and another to run GDB with remote debugging.</p>
  <p>First, run xv6 with remote debugging enabled:</p>
  <p class="code">$ make qemu-nox-gdb</p>
  <p>You will notice that this time xv6 hangs during the boot-up process.  It is waiting for you to make a remote connection using GDB, so let's do that.  In another terminal window, in the xv6 directory, type:</p>
  <p class="code">$ gdb kernel/kernel</p>
  <p>The first time you will probably get a warning that says:</p>
  <p>...<span class="code">auto-loading has been declined by your `auto-load safe-path'</span>...</p>
  <p>Fortunately, it also tells you how to fix the problem:</p>
  <p class="code">
    <font color="red">To enable execution of this file add<br/>
    &nbsp;&nbsp;&nbsp;&nbsp;add-auto-load-safe-path /&lt;path-to-xv6&gt;/xv6/.gdbinit<br/>
line to your configuration file "/home/&lt;username&gt;/.gdbinit".</font><br/>
    To completely disable this security protection add<br/>
    &nbsp;&nbsp;&nbsp;&nbsp;set auto-load safe-path /<br/>
line to your configuration file "/home/&lt;username&gt;/.gdbinit".
  </p>
  <p>Go ahead and quit out of GDB so that you can follow the message instructions.  You'll probably have to create a <span class="code">.gdbinit</span> file in your home directory (there is already a separate .gdbinit in your xv6 directory, which you should NOT touch--leave it be).  You should create (or, if it already exists, modify) <span class="code">/home/&lt;username&gt;/.gdbinit</span> as suggested in the message.  We recommend using the <span class="code">add-auto-load-safe-path</span> method, which we have highlighted in <font color="red">red</font> above.</p>
  <p>Once you have fixed your .gdbinit file, you can run GDB again:</p>
  <p class="code">$ gdb kernel/kernel</p>
  <p>This time, when GDB starts up, you should see the following lines in the output:</p>
  <p><span class="code">
    Connecting to QEMU<br/>
    (gdb) target remote localhost:25273</span>   &nbsp;&nbsp;&nbsp;&nbsp;(&lt;--port number may differ)
  </p>
  
  <p>Now let's insert a breakpoint in the <span class="code">exec</span> function.  This kernel-level function is invoked whenever a new process is executed.  In GDB, you can set the breakpoint by typing:</p>
  <p class="code">(gdb) b exec</p>
  <p>We are now ready to let xv6 finish booting.  In GDB, let xv6 continue by typing:</p>
  <p class="code">(gdb) c</p>
  
  <p>In your xv6 terminal, you should see the system begin to boot:</p>
  <p class="code">
    xv6...</br>
    lapicinit: 1 0xfee00000</br>
    cpu1: starting</br>
    cpu0: starting</br>
  </p>
  <p>Then it hits the <span class="code">exec</span> function for the first time, triggering the breakpoint.  In GDB, you should see:</p>
    <p class="code">
      Breakpoint 1, exec (path=0x1c "/init", argv=0xff0e98) at kernel/exec.c:11</br>
      11      {</br>
  </p>
  <p>Notice the part that says: <span class="code">path=0x1c "/init"</span><br/>
    This means that <span class="code">exec</span> is about to execute the <span class="code">init</span> process.  We have just discovered the first process that xv6 executes during boot-up!</p>
  
  <p>Keep typing 'c' or "continue" in GBD until xv6 reaches the shell prompt, noting the process(es) executed along the way.  Once at the shell prompt, you can type an xv6 command to run a program, which should trigger your breakpoint again.  You can then type 'c' in GDB to allow the program to run to completion.  NOTE: Some programs may behave differently when remote debugging is in use.</p>
  <p>You can now repeat your previous tour of xv6, but this time you can set breakpoints and use other GDB features to do some more thorough snooping around.</p>
  
  <h4 id="exit-xv6-qemu-gdb">Exit xv6, QEMU, and GDB:</h4>
  
  <p>When you've had enough, you can exit xv6 and QEMU as before by typing <span class="code">control+a</span> then <span class="code">x</span>.  You can exit GDB by typing <span class="code">q</span> then <span class="code">enter</span>.
  
  
  <h3>A Note on Platforms and Working Remotely</h3>

  <p>For your projects, we STRONGLY recommend using the lab machines.  If the labs are full, you can still work remotely by SSH-ing into a lab machine.  That being said, it may be possible to complete the projects on your personal machine.  The easiest approach is to install xv6 in a recent version of the Linux operating system.  If you are not running Linux, you can run Ubuntu inside a VM (like the freely available <a href="https://www.virtualbox.org/">VirtualBox</a>).  The next easiest approach (which the TA couldn't get to work after several hours) is to try to run xv6 and QEMU on Mac OS X.  There are a few websites that provide instructions (e.g., <a href="https://github.com/akhenakh/hugo-blog/blob/master/content/post/2012/01/05/compile-and-run-xv6-mac-os-x-6828.md">here</a> and <a href="https://doesnotscale.com/compiling-xv6-on-os-x-10-9/">here</a>). If you run Windows on your personal machine, your best bet is to SSH into the lab machines (recommended!), or use a Linux VM as mentioned above.</p>
    
</div><div class="attachmentsContainer">

<div class="attachmentsList" id="attachmentsList_com_content_default_333"></div>

</div>
	
</div>




<script src="http://www.google-analytics.com/urchin.js" type="text/javascript"> </script>
<script type="text/javascript"> _uacct = "UA-2595418-1"; urchinTracker(); </script>

</body>
</html>
